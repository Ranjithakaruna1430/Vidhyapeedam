<!DOCTYPE html>
<html lang="ta">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>роЖродрпНроо роЮро╛рой роЪро╛ро╕рпНродрпНро░ ро╡ро┐родрпНропро╛ рокрпАроЯроорпН</title>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>
    <style>
      body {
        font-family: "Poppins", sans-serif;
        background: linear-gradient(135deg, #ede7f6, #f3e5f5);
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        margin: 0;
      }
      .container {
        background: white;
        padding: 28px;
        border-radius: 16px;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        width: 340px;
        text-align: center;
      }
      .logo {
        font-size: 46px;
      }
      h1 {
        font-size: 20px;
        color: #5e35b1;
        margin-top: 8px;
        margin-bottom: 20px;
      }
      input,
      button {
        width: 100%;
        padding: 10px;
        margin: 6px 0;
        border-radius: 10px;
        border: 1px solid #ddd;
        font-size: 15px;
        box-sizing: border-box;
      }
      button {
        background-color: #7e57c2;
        color: white;
        border: none;
        cursor: pointer;
      }
      button:hover {
        background-color: #6a44b1;
      }
      .counts {
        text-align: left;
        margin-top: 16px;
        color: #4a148c;
        font-size: 15px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="logo">ЁЯкФ</div>
      <h1>роЖродрпНроо роЮро╛рой роЪро╛ро╕рпНродрпНро░ ро╡ро┐родрпНропро╛ рокрпАроЯроорпН</h1>

      <input id="name" type="text" placeholder="Enter your name" />
      <input id="date" type="date" />
      <input id="count" type="number" placeholder="Enter count" />

      <button onclick="saveData()">Save</button>

      <div class="counts">
        <div><strong>User Total Count:</strong> <span id="userTotal">тАФ</span></div>
        <div><strong>Group Total Count:</strong> <span id="groupTotal">тАФ</span></div>
      </div>

      <p id="status" style="color: #6b4e8a; margin-top: 10px"></p>
    </div>

    <script>
      // Your Firebase config
      const firebaseConfig = {
        apiKey: "AIzaSyAo9fjlWFSnUgBZQIubh5bGoIyoFBDg1h8",
        authDomain: "vidyapeedam.firebaseapp.com",
        databaseURL: "https://vidyapeedam-default-rtdb.firebaseio.com",
        projectId: "vidyapeedam",
        storageBucket: "vidyapeedam.firebasestorage.app",
        messagingSenderId: "883726093815",
        appId: "1:883726093815:web:44b8bd52b14942ee5ef2f2",
        measurementId: "G-8ZWRBXCM52"
      };

      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);
      const db = firebase.database();

      // Realtime group total
      firebase
        .database()
        .ref("users")
        .on("value", (snapshot) => {
          let total = 0;
          snapshot.forEach((childSnap) => {
            const val = childSnap.val();
            total += Number(val.totalCount || 0);
          });
          document.getElementById("groupTotal").innerText = total;
        });

      async function saveData() {
        const name = document.getElementById("name").value.trim();
        const date = document.getElementById("date").value;
        const count = parseInt(document.getElementById("count").value);
        const status = document.getElementById("status");

        if (!name || isNaN(count) || count < 0) {
          alert("Please enter valid name and count");
          return;
        }

        const key = name.replace(/[.#$/\[\]]/g, "_").toLowerCase();
        const userRef = db.ref("users/" + key);

        try {
          const snapshot = await userRef.get();
          let prevTotal = 0;
          if (snapshot.exists()) {
            prevTotal = snapshot.val().totalCount || 0;
          }
          const newTotal = prevTotal + count;

          await userRef.set({
            name,
            lastDate: date,
            lastCount: count,
            totalCount: newTotal,
          });

          document.getElementById("userTotal").innerText = newTotal;
          document.getElementById("count").value = "";
          status.innerText = "Saved successfully тЬУ";
        } catch (error) {
          console.error("Error saving:", error);
          status.innerText = "Error saving data!";
        }
      }

      // Load user total on name change
      document.getElementById("name").addEventListener("blur", async () => {
        const name = document.getElementById("name").value.trim();
        if (!name) return;
        const key = name.replace(/[.#$/\[\]]/g, "_").toLowerCase();
        const snap = await db.ref("users/" + key).get();
        if (snap.exists()) {
          document.getElementById("userTotal").innerText =
            snap.val().totalCount || 0;
        } else {
          document.getElementById("userTotal").innerText = 0;
        }
      });
    </script>
  </body>
</html>
